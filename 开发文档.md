# 用户模块

## 分析需求

- 权限管理（身份管理）：用户分为普通用户和管理员，管理员拥有额外的用户管理权限
- 注册
  - 校验用户名
  - 校验密码
  - 只允许注册普通用户
- 登陆
  - 登录错误时不提示具体的信息
- 管理员可以管理所有的用户（查询或删除）



## 技术栈

- SpringBoot + MyBatis Plus



## 设计接口

> 接口为 `/api/user/xxx`, 其中api是项目的根路径，在配置文件中设置，user表示模块。
>
> 返回值统一封装一个类，包含code、message、description、data等字段。
>
> 异常枚举类：
>
> ```java
> SUCCESS(0, "ok", ""),
> PARAMS_ERROR(40000, "请求参数错误", ""),
> NULL_ERROR(40001, "请求数据为空", ""),
> NOT_LOGIN(40100, "未登录", ""),
> NO_AUTH(40101, "无权限", ""),
> SYSTEM_ERROR(50000, "系统内部异常", "");
> ```

- 用户注册接口
  - 接口名：register
  - 接收参数：账号、密码、确认密码
  - 返回：注册新用户的id
- 用户登录接口
  - 接口名：login
  - 接收参数：账号、密码
  - 返回：脱敏后的用户
- 退出登录
  - 接口名：logout
  - 接收参数：无
  - 返回：固定返回1

**管理用户相关（仅限管理员可以调用）：**

- 查询用户
  - 接口名：search
  - 接收参数：用户名（模糊查询）
  - 返回：List of user
- 获取当前用户
  - 接口名：current
  - 接收参数：无
  - 返回：脱敏后的用户对象
- 删除用户
  - 接口名：delete
  - 接收参数：要删除的id
  - 返回：Boolean（是否删除成功）
- 是否为管理员（封装的私有方法）
  - 接收参数：request请求对象
  - 是管理员返回true，否则返回false





## 业务层设计思路

- 注册
  1. 校验参数是否为空
  2. 校验参数是否合法（用户名和密码长度，两次密码是否一致等）
  3. 查询数据库（不允许账号、星球编号重复）
  4. 对密码加密
  5. 添加数据到数据库
- 登录
  1. 校验参数是否为空
  2. 校验参数是否合法
  3. 加密密码，查询数据库比较
  4. 脱敏，返回
- 获取当前用户
  1. 从session中取数据
  2. 根据id从数据库中查询（防止用户已经失效，比如被删除）
  3. 脱敏、返回
- 查询用户
  1. 校验权限
  2. 模糊查询数据库
- 删除用户
  1. 校验权限
  2. 判断待删除的id是否合法（不能小于0）
  3. 从数据库中逻辑删除